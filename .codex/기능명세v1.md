


## 1.  Context & Goals
- Markdown 기반 노트, 데스크탑/모바일 클라이언트.
- 클라이언트 : Desktop / Mobile

### 1.1.  *핵심 목표*

- **노트 구조화** : 폴더 트리(깊이 10), 태그, 즐겨찾기
- **빠른 검색** : 제목/테그 + 본문 전문 검색, 휴지통 포함 옵션
- **공유** : 기본 private, 링크/사용자 ACL, 노트/폴더 공유 가능, 폴더 공유 시 상속(하위 노트/폴더에 자동 적용)
- **멀티 디바이스 동기화** : 충돌 관리 必
- 자동 저장 기능 : 1.5s debounce / 5s throttle

### 1.2.  *부가 기능*
- 휴지통 : Soft Delete -> 기간 경과 시 Hard Delete
- 팀/조직 워크스페이스 지원
- 파일 첨부 : 임시로 MinIO, 전략 패턴으로 스토리지 확장
- PDF Export : 노트를 PDF 로 변환


## 2.  기능 정리

### 2.1.  User

- [ ] *로그인 기능*
    - OAuth 2.0 : Google, GitHub, Kakao 등
- [ ] *세션 관리* : JSWT
- [ ] *로그 t t 아웃*
    - 해당 디바이스만 로그아웃하기
    - 전체 로그아웃 옵션

- [ ] *사용사 설정(옵션)*
    - 테마 설정 가능
    - 해당 작업 공간의 Visibility 기본 값 부여 가능
    - 휴지통 보관 기간 설정 가능
    - 자동 저장 활성화/비활성화

### 2.2.  노트

- [ ] *멀티 디바이스 동기화를 지원한다.*
- [ ] *생성*
    - *기본 값*
        - 제목은 "". But UI에서는 Untitled 표시하기(DB 노이즈 없애기 위해)
        - content은 ""다.
    - *생성 위치*
        - 현재 선택된 폴더가 있으면 그 폴더에 생성
        - 선택된 폴더가 없으면 루트 폴더에 생성

- [ ] *본문 Markdown 지원*
    - 노트 본문은 Markdown 기반으로 이루어진다.
    - 노트 본문은 Markdown이 아닌 UI?로도 가능?(T-Story처럼)

- [ ] *이동*
    - 노트의 위치는 이동될 수 있다.
    - 이동 시 폴더 상속관계도 수정된다.

- [ ] *검색*
    - 제목, 본문, 테그를 기준으로 검색할 수 있다.
    - 어떻게??? 검색??? (처음엔 FTS, 나중엔 Vector)

- [ ] *삭제*
    - 삭제 시 soft 삭제 (휴지통으로 이동)

- [ ] *수정*
    - 제목, 테그 수정
    - 본문 내용 수정 할 수 있다.

- [ ] *Auto-Save 기능*
    - 노트는 자동으로 저장된다.
    - 대부분의 내용은 **변경 시 입력 이벤트를 기준으로 변경 요청**을 한다.
        - title
        - content
        - tags
    - *입력 이벤트*
        - debounce: **1.5초** (키 입력 멈춘 뒤 저장)
        - throttle: **5초** (연속 입력 중에도 5초마다 강제 저장)
    - *일부 기능은 즉시 저장*되게 한다
        - Folder 이동
        - Visibility 변경


- [ ] *미리보기 기능*
    - *표시 필드*
        - Title
        - Tag
        - Content N자(줄바꿈 제거 및 마크다운 제거)
        - 최근 수정 상대시간:
            - N분 이내: `Xm`
            - N시간 이내: `Xh`
            - 그 이상: `YYYY-MM-DD` 같은 절대 날짜 추천
    - *미리 보기되는 목록*
        - (선택 1)특정 폴더에 있는 노트들을 미리보기
        - (선택 2)최근 작업하던 노트들의 미리보기

- [ ] *Cursor 기능(옵션)*
    - 사용자의 마지막 커서위치를 기억하고 재사용한다.

- [ ] PDF 추출
  - 

### 2.3.  폴더 관리


- [ ] *변경 시 일괄 갱신*
    - 폴더 삭제/이동 시 상속된 폴더/노트도 반영된다.
    - depth 제한이 넘으면 폴더 이동이 불가능하다.

- [ ] 특정 노트가 어느 폴더에 위치하는지 알 수 있다. ex. Dev/OS/note-1
- [ ] *제한*
    - 폴더명 길이 제한 (N)
    - 같은 레벨(Depth)의 중복이름 불허
    - 폴더의 깊이 : 5(임시)
- [ ] *폴더명은 언제든 변경 가능*
    - 변경 시 영향: - 하위 노트/폴더의 경로 표시는 즉시 반영
    - 공유 링크는 folderId 기반이면 영향 없음

### 2.4.  공유
- [ ] *노트/폴더는 공유 될 수 있다.*
    - 기본적으로 노트/폴더는 private이다.
    - 하지만 공유될 수도 있다

- [ ] *공유 범위*
    - 기본 : 읽기 전용으로 공유
    - 향후 : edit 권한 부여 가능

- [ ] *상속*
    - 폴더가 공유되면 상속된 폴더/노트들은 전부 공유된다.

- [ ] *공유 방법*
    - [ ] 특정 사용자에게 공유할 수 있다.(읽기 권한)
    - [ ] 특정 링크를 가진 사용자에게 공유될 수 있다.
        - 기간 설정 가능
        - 기본적으로 기간은 무제한
        - 폴더/노트명 변경이 공유 링크에 영향을 주면 안된다.
- [ ] *공유 취소*
    - 공유를 취소할 수 있습니다.
    - 삭제된 링크는 유효하지 않으며, 읽기 권한이 사라질 수 있습니다.

| 구분  | permissions | share_links |
| --- | ----------- | ----------- |
| 대상  | 특정 유저       | 링크 가진 아무나   |
| 인증  | 로그인 필수      | 로그인 없이 가능   |
| 추적  | 누가 접근했는지 앎  | 모름          |
| 취소  | 특정 유저만 제거   | 링크 비활성화     |

### 2.5.  휴지통

- [ ] *Soft 삭제*
    - 특정 유저가 노트/폴더를 삭제 시 일정 기간 동안 휴지통에 배치된다

- [ ] *폴더 삭제 시*
    - 특정 폴더 삭제 시 폴더 형태로 휴지통에 들어간다.
- [ ] *휴지통 삭제 기능*
    - [ ] 부분 삭제 기능
    - [ ] 전체 삭제 기능 (비우기)

- [ ] *복구 정책*
    - 폴더 + 하위 모두 ACTIVE로 복구
    - 원래 parent가 이미 삭제된 경우 (택 1)
        1. 루트로 복구
        2. 사용자에게 위치 선택

- [ ] *Hard 삭제 정책*
    - Trash 보관 N일 후 : 폴더 하위 노트/자산까지 일괄 영구 삭제

### 2.6.  테그

- [ ] *생성*
    - 사용자는 각 노트에 테그를 임의로 지정할 수 있다.

- [ ] *테그 정규화*
    - Tag는 공백을 허용하지 않는다.
    - 대소문자 구분 없음
    - Tag는 특수문자를 허용하지 않는다? (협의 必)

- [ ] *검색 - 테그별 모아보기*
    - 해당 유저의 노트들 중 테그기반으로 검색할 수 있다.
    - *테그에 해당하는 노트를 클릭 시*
        - 어카지??
        - 그 노트가 위치하는 곳으로? 아니면 그냥 거기서 보기?

- [ ] *테그 삭제*
    - 테그 삭제 시 해당 테그는 전체 노트에서 사라진다.
    - 테그 삭제 시 hard 삭제 (휴지통에 들어가지 않음)

### 2.7.  파일 첨부 (이건 나중에 공부좀 하고 보완)
> 노트에 들어가는 첨부 파일 처리 (attachments)

- [ ] 사용자는 노트 본문에 사진, 파일(.pdf)을 첨부할 수 있다.
- [ ] 노트 본문에는 참조 링크만 존재한다.
    - ex. `![alt](assets:/{assetId})`
- [ ] *저장*
    - 실제 데이터는 MinIO(임시)같은 Object Storage에 저장
    - DB에는 메타데이터 + 소유/권한 + 참조 관계만 저장한다.
- [ ] *삭제 정책*
    - 공유/휴지통/삭제 정책은 노트/폴더와 동일하다
    - 삭제 정책은 상속되지 않는다.
        - 노트가 삭제된다해도 다른 곳에서 참조할 수 있기 때문에
- [ ] *리사이즈(옵션)*
    - 사진 업로드 시 자체적으로 리사이즈 가능하다.
    - 이거 하려면 python 라이브러리 사용 ㄱ
- [ ] *썸네일*
    - PDF 프리뷰 기능을 제공한다

- [ ] *파일 타입 제한*
    - 허용 타입(v1) : png/jpg, pdf
    - 최대 크기 :



### 2.8.  워크 스페이스 (추후 MVP되면)
> 여러 사용자가 협업하는 공간

- [ ] 생성
- [ ] 초대
    - 이메일로 멤버 초대
    - 역할 지정
- [ ] 역할 변경
- [ ] 멤버 제거
- [ ] 소유권 이전(Owner)
- [ ] 삭제 

